#include <iostream>
#include <string>

using namespace std;

// Функция для шифрования/дешифрования символа
char caesarCipher(char ch, int shift, bool encrypt) {
  // Проверка, является ли символ буквой
  if (isalpha(ch)) {
    // Определение базового символа (A или a)
    char base = isupper(ch) ? 'A' : 'a';
    // Вычисление сдвига
    int shifted = ((ch - base + shift) % 26 + 26) % 26;
    // Возврат сдвинутого символа
    return base + shifted;
  } else {
    // Возврат не буквенного символа без изменений
    return ch;
  }
}

int main() {
  // Цикл для обработки ввода от пользователя
  while (true) {
    char operation;
    int shift, length;

    // Запрос выбора операции
    cout << "Введите операцию (E для шифрования, D для дешифрования): ";
    cin >> operation;

    // Проверка выбора операции
    if (operation != 'E' && operation != 'D') {
      cout << "Неверный выбор операции! Завершение работы.\n";
      break;
    }

    // Запрос сдвига
    cout << "Введите сдвиг: ";
    cin >> shift;

    // Запрос длины строки
    cout << "Введите длину строки: ";
    cin >> length;

    // Проверка длины строки
    if (length <= 0) {
      cout << "Некорректная длина строки! Завершение работы.\n";
      break;
    }

    // Инициализация массива символов
    char arr[length + 1]; // Добавлен +1 для символа конца строки

    // Запрос массива символов
    cout << "Введите строку: ";
    cin.ignore(); // Очистка буфера ввода

    // Проверка длины вводимой строки:
    char temp[length + 1];  // Временный массив для чтения строки
    cin.getline(temp, length + 1); // Считывание строки в временный массив

    // Проверка, не превышает ли длина введенной строки заданную длину:
    if (strlen(temp) != length) {
      cout << "Введенная строка не соответствут заданной длине строки! Завершение работы.\n";
      main(); 
    }

    // Копирование введенной строки в массив arr:
    strcpy(arr, temp);

    // Проверка вводимых символов
    for (int i = 0; i < length; i++) {
      if (!isalpha(arr[i])) {
        break;
      }
    }

    // Вычисление сдвига с учетом цикличности алфавита
    shift %= 26;

    // Шифрование или дешифрование строки
    for (int i = 0; i < length; i++) {
      arr[i] = caesarCipher(arr[i], shift, operation == 'E');
    }

    // Вывод результата
    cout << "Результат: ";
    for (int i = 0; i < length; i++) {
      cout << arr[i];
    }
    cout << endl;
  }

  return 0;
}
